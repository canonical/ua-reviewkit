# See README.md and 'ua-bundle-check.py --schema' for usage and schema details
checks:
  mysql-percona:
    charm: "percona-cluster"
    assertions:
      ha:
        assert_ha:
          scope: application
      innodb-buffer-pool-size:
        gte:
          scope: config
          source: local
          value: 6G
      max-connections:
        gte:
          scope: config
          source: local
          value: 2000
  mysql-innodb-cluster:
    charm: "mysql-innodb-cluster"
    assertions:
      ha:
        assert_ha:
          scope: application
      innodb-buffer-pool-size:
        gte:
          scope: config
          source: local
          value: 6G
      max-connections:
        gte:
          scope: config
          source: local
          value: 2000
  rabbitmq-server:
    charm: "rabbitmq-server"
    assertions:
      ha:
        assert_ha:
          scope: application
      cluster-partition-handling:
        allow_default:
          scope: config
        neq:
          scope: config
          source: local
          value: "autoheal"
  etcd:
    charm: "etcd"
    assertions:
      ha:
        assert_ha:
          scope: application
  barbican:
    charm: "barbican"
    assertions:
      ha:
        assert_ha:
          scope: application
  ceph-mon:
    charm: "ceph-mon"
    assertions:
      ha:
        assert_ha:
          scope: application
  ceph-osd:
    charm: "ceph-osd"
    assertions:
      bluestore-block-wal-size:
        allow_default:
          scope: config
        gte:
          scope: config
          source: local
          value: 1G
  ceph-proxy:
    charm: "ceph-proxy"
    assertions:
  ceph-radosgw:
    charm: "ceph-radosgw"
    assertions:
      ceph-osd-replication-count:
        allow_default:
          scope: config
        eq:
          scope: config
          source: local
          value: 3
  cinder:
    charm: "cinder"
    assertions:
      ha:
        assert_ha:
          scope: application
  cinder-ceph:
    charm: "cinder-ceph"
    assertions:
      ceph-osd-replication-count:
        allow_default:
          scope: config
        eq:
          scope: config
          source: local
          value: 3
  designate:
    charm: "designate"
    assertions:
      ha:
        assert_ha:
          scope: application
  glance:
    charm: "glance"
    assertions:
      ha:
        assert_ha:
          scope: application
      ceph-osd-replication-count:
        allow_default:
          scope: config
        eq:
          scope: config
          source: local
          value: 3
  gnocchi:
    charm: "gnocchi"
    assertions:
      ha:
        assert_ha:
          scope: application
  heat:
    charm: "heat"
    assertions:
      ha:
        assert_ha:
          scope: application
  keystone:
    charm: "keystone"
    assertions:
      ha:
        assert_ha:
          scope: application
  manilla:
    charm: "manilla"
    assertions:
      ha:
        assert_ha:
          scope: application
  neutron-api:
    charm: "neutron-api"
    assertions:
      ha:
        assert_ha:
          scope: application
      # Check jumbo frames are enabled.
      global-physnet-mtu:
        eq:
          scope: config
          source: local
          value: 9000
          warn-on-fail: true
  nova-cloud-controller:
    charm: "nova-cloud-controller"
    assertions:
      ha:
        assert_ha:
          scope: application
  nova-compute:
    charm: "nova-compute"
    assertions:
      vcpu-pin-set:
        allow_default:
          scope: config
        eq:
          scope: config
          source: master
          value: '.*kernel_opts:.+isolcpus=([0-9\-,]+).*'
          warn-on-fail: true
      cpu-model:
        isset:
          scope: config
          source: bundle
      ephemeral-device:
        allow_default:
          scope: config
          source: bundle
        exclusive_backing_dev:
          description: "ensure that nova instances path (if using bcache) is not backed by same physical disk as rootfs"
          scope: config
          source: bucketsconfig
      ceph-osd-replication-count:
        allow_default:
          scope: config
        eq:
          scope: config
          source: local
          value: 3
  octavia:
    charm: "octavia"
    assertions:
      ha:
        assert_ha:
          scope: application
  placement:
    charm: "placement"
    assertions:
      ha:
        assert_ha:
          scope: application    
  swift-proxy:
    charm: "swift-proxy"
    assertions:
      ha:
        assert_ha:
          scope: application
  sysconfig:
    charm: "sysconfig"
    assertions:
      governor:
        eq:
          scope: config
          source: local
          value: "performance"
  vault:
    charm: "vault"
    assertions:
      ha:
        assert_ha:
          scope: application
  hacluster:
    charm: "hacluster"
    assertions:
      cluster_count:
        allow_default:
          scope: config
        gte:
          scope: config
          source: local
          value: 3
